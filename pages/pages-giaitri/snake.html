<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>R·∫Øn SƒÉn M·ªìi üêç (PC & Mobile)</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --container-bg: #2c2c2c;
            --snake-color: #4CAF50;
            --food-color: #F44336;
            --text-color: #FFFFFF;
            --button-bg: #444;
        }
        
        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow: hidden;
        }

        /* --- Giao di·ªán PC (M·∫∑c ƒë·ªãnh) --- */
        /* CƒÉn gi·ªØa m·ªçi th·ª© tr√™n m√†n h√¨nh l·ªõn */
        body {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #app-container {
            width: 100%;
            max-width: 500px; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông tr√™n PC */
            background-color: var(--container-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        #game-area {
            position: relative;
            width: 100%;
        }

        #header {
            text-align: center;
            margin-bottom: 15px;
        }

        #score {
            font-size: 1.8em;
            font-weight: bold;
        }

        #game-canvas {
            display: block;
            width: 100%;
            height: auto;
            border: 2px solid var(--snake-color);
            background-color: #000;
        }

        #controls-area {
            display: none; /* ·∫®n khu v·ª±c ƒëi·ªÅu khi·ªÉn tr√™n PC */
        }
        
        #message-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 1.5em;
            visibility: hidden; opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
            z-index: 10;
        }
        
        #message-overlay.show {
            visibility: visible; opacity: 1;
        }


        /* --- Giao di·ªán Mobile (Cho m√†n h√¨nh r·ªông d∆∞·ªõi 768px) --- */
        /* Ghi ƒë√® c√°c style tr√™n ƒë·ªÉ chuy·ªÉn sang b·ªë c·ª•c to√†n m√†n h√¨nh */
        @media (max-width: 768px) {
            body {
                display: block; /* B·ªè cƒÉn gi·ªØa */
            }

            #app-container {
                display: flex;
                flex-direction: column;
                width: 100%;
                height: 100%;
                max-width: none;
                padding: 0;
                border-radius: 0;
                background-color: transparent;
                box-shadow: none;
            }

            #game-area {
                flex-grow: 1; /* Chi·∫øm h·∫øt kh√¥ng gian th·ª´a */
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 10px;
            }

            #game-canvas {
                width: auto; /* ƒê·ªÉ canvas t·ª± t√≠nh to√°n */
                height: auto;
            }
            
            #controls-area {
                display: grid; /* Hi·ªán khu v·ª±c ƒëi·ªÅu khi·ªÉn */
                place-items: center;
                flex-shrink: 0;
                padding: 15px 0;
                background-color: #222;
            }

            #controls {
                display: grid;
                grid-template-columns: repeat(3, 70px);
                grid-template-rows: repeat(2, 70px);
                gap: 15px;
            }

            #controls button {
                width: 100%; height: 100%;
                background-color: var(--button-bg); color: white;
                border: none; border-radius: 20px; font-size: 2.2em;
                display: flex; align-items: center; justify-content: center;
            }

            .up { grid-column: 2; grid-row: 1; }
            .left { grid-column: 1; grid-row: 2; }
            .down { grid-column: 2; grid-row: 2; }
            .right { grid-column: 3; grid-row: 2; }
        }

    </style>
</head>
<body>

    <div id="app-container">
        <div id="game-area">
            <div id="header">
                <div id="score">ƒêi·ªÉm: 0</div>
            </div>
            <canvas id="game-canvas"></canvas>
            <div id="message-overlay">
                <div id="message-title"></div>
                <div id="message-subtitle" style="font-size: 0.7em; margin-top: 10px;"></div>
            </div>
        </div>
        <div id="controls-area">
            <div id="controls">
                <button class="up">‚ñ≤</button>
                <button class="left">‚óÑ</button>
                <button class="down">‚ñº</button>
                <button class="right">‚ñ∫</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ... (To√†n b·ªô code JavaScript t·ª´ phi√™n b·∫£n tr∆∞·ªõc)
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const scoreElement = document.getElementById('score');
            const messageOverlay = document.getElementById('message-overlay');
            const messageTitle = document.getElementById('message-title');
            const messageSubtitle = document.getElementById('message-subtitle');
            const gameArea = document.getElementById('game-area');

            const gridSize = 20;
            let tileCount;

            function setupCanvasSize() {
                let canvasSize;
                const isMobile = window.innerWidth <= 768;

                if (isMobile) {
                    const headerHeight = document.getElementById('header').offsetHeight;
                    const availableWidth = gameArea.clientWidth - 20;
                    const availableHeight = gameArea.clientHeight - headerHeight - 20;
                    canvasSize = Math.min(availableWidth, availableHeight);
                } else {
                    canvasSize = gameArea.clientWidth;
                }
                
                canvas.width = canvas.height = canvasSize - (canvasSize % gridSize);
                tileCount = canvas.width / gridSize;
            }

            const directions = {
                'UP': { x: 0, y: -1 }, 'DOWN': { x: 0, y: 1 },
                'LEFT': { x: -1, y: 0 }, 'RIGHT': { x: 1, y: 0 }
            };

            let snake, food, velocity, score, gameRunning;

            function initializeGame() {
                setupCanvasSize();
                snake = [{ x: Math.floor(tileCount / 2), y: Math.floor(tileCount / 2) }];
                velocity = { x: 0, y: 0 };
                score = 0;
                gameRunning = false;
                updateScore();
                generateFood();
                drawEverything();
                showMessage("R·∫Øn SƒÉn M·ªìi", "Nh·∫•n ph√≠m ho·∫∑c n√∫t di chuy·ªÉn ƒë·ªÉ b·∫Øt ƒë·∫ßu");
            }

            function gameLoop() {
                if (!gameRunning) return;

                const head = { x: snake[0].x + velocity.x, y: snake[0].y + velocity.y };

                if (head.x < 0) head.x = tileCount - 1;
                if (head.x >= tileCount) head.x = 0;
                if (head.y < 0) head.y = tileCount - 1;
                if (head.y >= tileCount) head.y = 0;

                for (let i = 1; i < snake.length; i++) {
                    if (head.x === snake[i].x && head.y === snake[i].y) {
                        gameOver(); return;
                    }
                }
                
                snake.unshift(head);

                if (head.x === food.x && head.y === food.y) {
                    score++; updateScore(); generateFood();
                } else {
                    snake.pop();
                }
                drawEverything();
            }
            
            function drawEverything() {
                ctx.fillStyle = "#000";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--snake-color');
                snake.forEach(part => {
                    ctx.fillRect(part.x * gridSize, part.y * gridSize, gridSize - 1, gridSize - 1);
                });

                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--food-color');
                ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 1, gridSize - 1);
            }
            
            function generateFood() {
                do {
                    food = {
                        x: Math.floor(Math.random() * tileCount),
                        y: Math.floor(Math.random() * tileCount)
                    };
                } while (snake.some(part => part.x === food.x && part.y === food.y));
            }

            function updateScore() { scoreElement.textContent = `ƒêi·ªÉm: ${score}`; }

            function gameOver() {
                gameRunning = false;
                showMessage("THUA R·ªíI!", `ƒêi·ªÉm c·ªßa b·∫°n: ${score}. Ch·∫°m ƒë·ªÉ ch∆°i l·∫°i.`);
            }

            function showMessage(title, subtitle) {
                messageTitle.textContent = title;
                messageSubtitle.textContent = subtitle;
                messageOverlay.classList.add('show');
            }

            function hideMessage() { messageOverlay.classList.remove('show'); }
            
            function handleInput(newDirection) {
                if (!gameRunning) {
                    velocity = newDirection; gameRunning = true; hideMessage();
                    return;
                }

                const isOpposite = snake.length > 1 && newDirection.x === -velocity.x && newDirection.y === -velocity.y;
                if (!isOpposite) { velocity = newDirection; }
            }

            function setupEventListeners() {
                window.addEventListener('keydown', e => {
                    let dir;
                    switch (e.key) {
                        case 'ArrowUp': dir = directions.UP; break;
                        case 'ArrowDown': dir = directions.DOWN; break;
                        case 'ArrowLeft': dir = directions.LEFT; break;
                        case 'ArrowRight': dir = directions.RIGHT; break;
                    }
                    if (dir) { e.preventDefault(); handleInput(dir); }
                });

                document.querySelector('.up').addEventListener('click', () => handleInput(directions.UP));
                document.querySelector('.down').addEventListener('click', () => handleInput(directions.DOWN));
                document.querySelector('.left').addEventListener('click', () => handleInput(directions.LEFT));
                document.querySelector('.right').addEventListener('click', () => handleInput(directions.RIGHT));

                messageOverlay.addEventListener('click', () => {
                    if (!gameRunning) initializeGame();
                });
                
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(initializeGame, 250);
                });
            }

            initializeGame();
            setupEventListeners();
            setInterval(gameLoop, 100);
        });
    </script>
</body>
</html>