<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Flappy Bird — Vinh ở Nhật</title>
<link rel="stylesheet" href="../../css/style.css">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html,body{height:100%;margin:0;background:#121212;color:#fff;font-family:Inter,system-ui;}
  .container{max-width:1100px;margin:0 auto;padding:12px}
  header{background:#fff;padding:.6rem 12px}
  .game-wrap{display:flex;justify-content:center;padding:20px 12px}
  .phone-frame{width:100%;max-width:420px;height:640px;background:#87CEEB;border-radius:18px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,.6);position:relative}
  canvas{display:block;width:100%;height:100%}
  .controls{display:flex;gap:8px;justify-content:center;margin-top:12px}
  .btn{background:#f6ad55;border:none;padding:.6rem .9rem;border-radius:8px;font-weight:700;cursor:pointer}
  .ghost{background:transparent;border:1px solid rgba(0,0,0,.08);padding:.5rem .75rem;border-radius:8px}
  .note{font-size:13px;color:#333;margin-top:6px}
</style>
</head>
<body>
<header class="container flex items-center justify-between">
  <div class="flex items-center gap-3">
    <a href="../../index.html"><img src="../../img/logo.png" style="height:40px;width:40px;border-radius:999px"></a>
    <div>
      <div style="color:#111;font-weight:700">Vinh ở Nhật</div>
      <div style="font-size:12px;color:#666">Flappy Bird</div>
    </div>
  </div>
  <div><a href="giaitri.html" class="ghost">Quay lại</a></div>
</header>

<div class="game-wrap">
  <div id="viewport" class="phone-frame" aria-label="Flappy game area"></div>
</div>
<div style="text-align:center">
  <button id="play" class="btn">Play</button>
  <button id="exit" class="ghost">Thoát</button>
  <div class="note">Trên điện thoại: nhấn Play → Cho phép Fullscreen → chạm để nhảy. Trên PC: mô phỏng khung điện thoại.</div>
</div>

<script>
// Simple Flappy standalone file
(function(){
  const viewport = document.getElementById('viewport');
  const playBtn = document.getElementById('play');
  const exitBtn = document.getElementById('exit');

  // build canvas inside phone frame
  const canvas = document.createElement('canvas');
  canvas.id = 'flappyCanvas';
  viewport.appendChild(canvas);
  const ctx = canvas.getContext('2d');

  function setSize() {
    const rect = viewport.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * devicePixelRatio);
    canvas.height = Math.floor(rect.height * devicePixelRatio);
    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
  }
  window.addEventListener('resize', setSize);
  setSize();

  let state = 'start', bird={x:70,y:150,vy:0,r:14}, pipes=[], score=0, spawn=0, speed=2.4;
  let last = performance.now();
  function spawnPipe(){
    const h = canvas.height/devicePixelRatio;
    const gap = Math.max(110, Math.floor(h*0.22));
    const min = 40;
    const top = Math.floor(Math.random()*(h - gap - min*2)) + min;
    const w = Math.max(48, Math.floor(canvas.width/devicePixelRatio*0.12));
    pipes.push({x:canvas.width/devicePixelRatio + 20, w, top, bottom: h - top - gap, passed:false});
  }
  function reset(){
    bird = {x:70, y: canvas.height/devicePixelRatio/2, vy:0, r:14};
    pipes = []; score = 0; spawn = 0; speed = Math.max(2.2, canvas.width/360*2.4);
    state = 'play';
  }
  function update(dt){
    if (state!=='play') return;
    bird.vy += 0.36; bird.y += bird.vy;
    spawn += dt;
    if (spawn > Math.max(900 - score*20, 600)) { spawnPipe(); spawn = 0; }
    for (const p of pipes) p.x -= speed;
    pipes = pipes.filter(p => p.x + p.w > -10);
    for (const p of pipes){
      if (!p.passed && p.x + p.w < bird.x){ p.passed = true; score++; speed += 0.06; }
      if (bird.x + bird.r > p.x && bird.x - bird.r < p.x + p.w){
        if (bird.y - bird.r < p.top || bird.y + bird.r > (canvas.height/devicePixelRatio - p.bottom)) { state='over'; }
      }
    }
    if (bird.y + bird.r > canvas.height/devicePixelRatio) { bird.y = canvas.height/devicePixelRatio - bird.r; state='over'; }
    if (bird.y - bird.r < 0) { bird.y = bird.r; bird.vy = 0; }
  }
  function draw(){
    const w = canvas.width/devicePixelRatio, h = canvas.height/devicePixelRatio;
    // sky
    ctx.fillStyle = '#87CEEB'; ctx.fillRect(0,0,w,h);
    // ground
    ctx.fillStyle = '#7c3aed'; ctx.fillRect(0, h-40, w, 40);
    // pipes
    for (const p of pipes){ ctx.fillStyle = '#2f855a'; ctx.fillRect(p.x,0,p.w,p.top); ctx.fillRect(p.x, h - p.bottom, p.w, p.bottom); }
    // bird
    ctx.beginPath(); ctx.fillStyle = '#f6ad55'; ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI*2); ctx.fill(); ctx.lineWidth = 2; ctx.strokeStyle='#333'; ctx.stroke();
    // score
    if (state!=='start'){ ctx.fillStyle='white'; ctx.font='28px Inter, sans-serif'; ctx.textAlign='center'; ctx.fillText(score, w/2, 56); }
    if (state==='start'){ ctx.fillStyle='rgba(0,0,0,0.4)'; ctx.fillRect(w/2 - 120, h/2 - 36, 240, 72); ctx.fillStyle='white'; ctx.font='16px Inter'; ctx.fillText('Nhấn Space / Chạm để nhảy', w/2, h/2); }
    if (state==='over'){ ctx.fillStyle='rgba(0,0,0,0.6)'; ctx.fillRect(w/2 - 140, h/2 - 60, 280, 120); ctx.fillStyle='white'; ctx.font='18px Inter'; ctx.fillText('Game over — Điểm: '+score, w/2, h/2 - 6); }
  }
  function loop(now){
    const dt = now - last; last = now;
    update(dt); draw();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  function jump(){
    if (state==='start'){ reset(); }
    if (state==='play'){ bird.vy = -8; }
    if (state==='over'){ reset(); }
  }

  // inputs
  window.addEventListener('keydown', (e)=>{ if (e.code==='Space') { e.preventDefault(); jump(); } if (e.code==='Escape' && document.fullscreenElement) document.exitFullscreen(); });
  canvas.addEventListener('mousedown', ()=> jump());
  canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); jump(); }, {passive:false});

  playBtn.addEventListener('click', ()=>{
    // on mobile request fullscreen, on pc keep as framed phone
    if (window.innerWidth < 640 && viewport.requestFullscreen) viewport.requestFullscreen();
    state='start'; reset();
  });
  exitBtn.addEventListener('click', ()=> location.href = 'giaitri.html');
  // initial state
  state='start';
})();
</script>
</body>
</html>