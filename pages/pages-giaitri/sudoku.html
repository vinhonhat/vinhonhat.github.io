<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sudoku — Vinh ở Nhật</title>
<link rel="stylesheet" href="../../css/style.css">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html,body{height:100%;margin:0;font-family:Inter,system-ui;background:#f7fafc;color:#111}
  header{background:#fff;padding:.6rem 12px}
  .container{max-width:900px;margin:0 auto;padding:12px}
  .grid{display:grid;grid-template-columns:repeat(9,1fr);gap:4px;max-width:540px;margin:auto;background:#fff;padding:8px;border-radius:8px}
  .cell{width:100%;height:44px;text-align:center;font-size:18px;font-weight:700;padding:6px;border:1px solid #e2e8f0;border-radius:4px}
  .fixed{background:#eef2ff}
  .controls{display:flex;justify-content:center;gap:8px;margin-top:12px}
  .btn{background:#f6ad55;border:none;padding:.5rem .75rem;border-radius:8px;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<header class="container flex items-center justify-between">
  <div class="flex items-center gap-3">
    <a href="../../index.html"><img src="../../img/logo.png" style="height:40px;width:40px;border-radius:999px"></a>
    <div><div style="color:#111;font-weight:700">Vinh ở Nhật</div><div style="font-size:12px;color:#666">Sudoku</div></div>
  </div>
  <div><a href="giaitri.html" style="background:transparent;border:1px solid rgba(0,0,0,.06);padding:.4rem .6rem;border-radius:8px">Quay lại</a></div>
</header>

<main class="container" style="padding-top:18px;padding-bottom:40px">
  <h2 style="text-align:center">Sudoku — kiểm tra & giải</h2>
  <div id="grid" class="grid" role="application" aria-label="Sudoku grid"></div>
  <div class="controls">
    <button id="check" class="btn">Kiểm tra</button>
    <button id="solve" class="btn">Giải</button>
    <button id="reset" class="btn">Tải lại</button>
  </div>
</main>

<script>
(function(){
  const preset = [
    5,3,0, 0,7,0, 0,0,0,
    6,0,0, 1,9,5, 0,0,0,
    0,9,8, 0,0,0, 0,6,0,
    8,0,0, 0,6,0, 0,0,3,
    4,0,0, 8,0,3, 0,0,1,
    7,0,0, 0,2,0, 0,0,6,
    0,6,0, 0,0,0, 2,8,0,
    0,0,0, 4,1,9, 0,0,5,
    0,0,0, 0,8,0, 0,7,9
  ];
  const grid = document.getElementById('grid');
  let cells = [];

  function build(){
    grid.innerHTML=''; cells=[];
    for(let i=0;i<81;i++){
      const input = document.createElement('input');
      input.type='text'; input.maxLength=1; input.className='cell';
      if(preset[i]){ input.value = preset[i]; input.disabled = true; input.classList.add('fixed'); }
      input.dataset.idx = i;
      input.addEventListener('input', ()=>{ input.value = input.value.replace(/[^1-9]/g,''); });
      grid.appendChild(input); cells.push(input);
    }
  }
  function read(){ return cells.map(c=> c.value?parseInt(c.value,10):0); }
  function valid(arr){
    for(let r=0;r<9;r++){
      const s = new Set();
      for(let c=0;c<9;c++){ const v=arr[r*9+c]; if(v){ if(s.has(v)) return false; s.add(v); } }
    }
    for(let c=0;c<9;c++){ const s=new Set(); for(let r=0;r<9;r++){ const v=arr[r*9+c]; if(v){ if(s.has(v)) return false; s.add(v); } } }
    for(let br=0;br<3;br++) for(let bc=0;bc<3;bc++){ const s=new Set(); for(let r=0;r<3;r++) for(let c=0;c<3;c++){ const v = arr[(br*3+r)*9 + (bc*3+c)]; if(v){ if(s.has(v)) return false; s.add(v); } } }
    return true;
  }
  function solve(arr){
    const idx = arr.findIndex(v=>v===0);
    if(idx===-1) return arr.slice();
    for(let n=1;n<=9;n++){ arr[idx]=n; if(valid(arr)){ const res = solve(arr); if(res) return res; } arr[idx]=0; }
    return null;
  }
  build();
  document.getElementById('check').addEventListener('click', ()=>{
    const arr = read();
    if(!valid(arr)) alert('Không hợp lệ: có số trùng');
    else if(arr.indexOf(0)===-1) alert('Hoàn thành và hợp lệ!');
    else alert('Hiện tại hợp lệ, chưa hoàn thành.');
  });
  document.getElementById('solve').addEventListener('click', ()=>{
    const arr = read(); const res = solve(arr);
    if(!res) alert('Không thể giải'); else { res.forEach((v,i)=> cells[i].value = v; ) }
  });
  document.getElementById('reset').addEventListener('click', ()=> build());
})();
</script>
</body>
</html>
