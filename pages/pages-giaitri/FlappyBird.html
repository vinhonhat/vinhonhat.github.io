<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Flappy Bird | Vinh ở Nhật</title>
    
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#F6AD55">
    <link rel="apple-touch-icon" href="../../img/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">

    <style>
        html, body { overflow: hidden; }
        main { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        #game-container {
            position: relative;
            width: 360px; height: 640px;
            max-width: 100vw; max-height: 85vh;
            border: 2px solid #333;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        #gameCanvas { width: 100%; height: 100%; display: block; }
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; z-index: 10;
        }
        #start-button {
            padding: 15px 30px; font-size: 24px; font-weight: bold;
            color: #333; background-color: #f6ad55;
            border: none; border-radius: 10px; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        #start-button:active { transform: scale(0.95); }
        #start-screen h2 { font-size: 36px; font-weight: bold; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }

        /* Mobile full screen */
        @media (max-width: 768px) {
            header, nav, footer { display: none !important; }
            body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; }
            main { margin: 0 !important; padding: 0 !important; width: 100vw !important; height: 100vh !important; }
            #game-container { position: fixed; top: 0; left: 0; width: 100vw !important; height: 100vh !important; border: none; max-width: 100%; max-height: 100%; }
        }

        /* Nút mobile */
        #mobile-controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: none; gap: 15px; z-index: 20; }
        .control-btn { padding: 10px 18px; font-size: 16px; border: none; border-radius: 8px; background: #f6ad55; color: #333; font-weight: bold; cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.2); }
        .control-btn:active { transform: scale(0.95); }
        @media (max-width: 768px) { #mobile-controls { display: flex !important; } }

        /* Nút thoát PC */
        #btn-exit-pc { position: absolute; top: 10px; left: 10px; padding: 6px 12px; font-size: 14px; border: none; border-radius: 6px; background: #f6ad55; color: #333; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 30; }
        @media (max-width: 768px) { #btn-exit-pc { display: none; } }
    </style>
</head>
<body class="bg-[#FBF7F0] flex flex-col min-h-screen">
    <header class="bg-white shadow-sm py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="../index.html" class="flex items-center space-x-2">
                <img src="../../img/logo.png" alt="Logo" class="h-12 w-12 rounded-full">
                <span class="text-xl font-bold text-gray-800 hidden sm:block">Vinh ở Nhật</span>
            </a>
            <div class="flex items-center space-x-4">
                <div class="text-right time-display">
                    <div id="time" class="time text-3xl font-bold leading-none text-gray-800">00:00:00</div>
                    <div id="date" class="date text-sm mt-1 text-gray-600">...</div>
                </div>
            </div>
        </div>
    </header>

    <nav class="bg-white shadow-sm mt-4 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-2">
            <ul class="hidden sm:flex justify-center sm:justify-between items-center space-x-4">
                <li><a href="#" class="menu-link hover:text-yellow-600">Bài viết HD</a></li>
                <li><a href="#" class="menu-link hover:text-yellow-600">Video hướng dẫn</a></li>
                <li><a href="#" class="menu-link hover:text-yellow-600">Tải ứng dụng</a></li>
                <li><a href="#" class="menu-link hover:text-yellow-600">Học tập</a></li>
                <li><a href="#" class="menu-link hover:text-yellow-600">Giải trí</a></li>
            </ul>
        </div>
    </nav>

    <main class="container mx-auto px-4 mt-8">
        <div id="game-container">
            <div id="start-screen">
                <h2>Flappy Bird</h2>
                <button id="start-button">Bắt đầu</button>
            </div>
            <canvas id="gameCanvas"></canvas>
            <button id="btn-exit-pc">Thoát</button>
            <div id="mobile-controls">
                <button id="btn-sound" class="control-btn">Âm thanh</button>
                <button id="btn-exit" class="control-btn">Thoát</button>
            </div>

            <!-- Âm thanh event -->
            <audio id="jump-sound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
            <audio id="gameover-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
        </div>
    </main>

    <footer class="bg-gray-800 text-white mt-12 py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400">&copy; 2025 Vinh ở Nhật. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // ===== Đồng hồ =====
        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('vi-VN', { hour12: false });
            const date = now.toLocaleDateString('vi-VN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('time').textContent = time;
            document.getElementById('date').textContent = date;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // ===== Game =====
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');
        const gameContainer = document.getElementById('game-container');
        const jumpSound = document.getElementById('jump-sound');
        const gameoverSound = document.getElementById('gameover-sound');

        canvas.width = gameContainer.clientWidth;
        canvas.height = gameContainer.clientHeight;

        const GRAVITY = 0.4, JUMP = -8, GAME_SPEED = 3;
        let bird, pipes, score, bestScore, currentGameState;
        const gameState = { start: 'start', playing: 'playing', gameOver: 'gameOver' };

        function resetGame() {
            bird = { x: 50, y: canvas.height / 2, radius: 15, velocity: 0 };
            pipes = []; score = 0; currentGameState = gameState.playing;
        }
        function drawBird() { ctx.beginPath(); ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI*2); ctx.fillStyle = '#f6ad55'; ctx.fill(); ctx.strokeStyle = '#333'; ctx.stroke(); ctx.closePath(); }
        function drawPipes() { pipes.forEach(pipe => { ctx.fillStyle = '#48bb78'; ctx.fillRect(pipe.x, 0, pipe.width, pipe.top); ctx.fillRect(pipe.x, canvas.height - pipe.bottom, pipe.width, pipe.bottom); }); }
        function drawScore() { if(currentGameState===gameState.start)return; ctx.fillStyle='white'; ctx.font='45px Inter, sans-serif'; ctx.textAlign='center'; ctx.fillText(score, canvas.width/2,60); ctx.strokeStyle='black'; ctx.lineWidth=2; ctx.strokeText(score,canvas.width/2,60);}        
        function drawGameOver(){ctx.fillStyle='rgba(0,0,0,0.7)';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle='white';ctx.font='40px Inter, sans-serif';ctx.textAlign='center';ctx.fillText('GAME OVER',canvas.width/2,canvas.height/2-50);ctx.font='24px Inter, sans-serif';ctx.fillText(`Điểm: ${score}`,canvas.width/2,canvas.height/2);ctx.fillText(`Cao nhất: ${bestScore}`,canvas.width/2,canvas.height/2+40);ctx.font='18px Inter, sans-serif';ctx.fillText('Chạm để chơi lại',canvas.width/2,canvas.height/2+100);}
        function updateBird(){bird.velocity+=GRAVITY;bird.y+=bird.velocity;if(bird.y-bird.radius<0){bird.y=bird.radius;bird.velocity=0;}}
        function updatePipes(){if(pipes.length===0||pipes[pipes.length-1].x<canvas.width-200){const gap=150;const minHeight=50;const topHeight=Math.random()*(canvas.height-gap-minHeight*2)+minHeight;pipes.push({x:canvas.width,width:60,top:topHeight,bottom:canvas.height-topHeight-gap,passed:false});}pipes.forEach(pipe=>pipe.x-=GAME_SPEED);pipes=pipes.filter(pipe=>pipe.x+pipe.width>0);}
        function checkCollision(){if(bird.y+bird.radius>canvas.height)return true;for(const pipe of pipes){if(bird.x+bird.radius>pipe.x&&bird.x-bird.radius<pipe.x+pipe.width){if(bird.y-bird.radius<pipe.top||bird.y+bird.radius>canvas.height-pipe.bottom){return true;}}}return false;}
        function updateScore(){pipes.forEach(pipe=>{if(!pipe.passed&&pipe.x+pipe.width<bird.x){pipe.passed=true;score++;}});}
        function gameLoop(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.fillStyle='#87CEEB';ctx.fillRect(0,0,canvas.width,canvas.height);if(currentGameState===gameState.playing){updateBird();updatePipes();updateScore();if(checkCollision()){currentGameState=gameState.gameOver;gameoverSound.play();if(score>bestScore){bestScore=score;localStorage.setItem('flappyBestScore',bestScore);}}}drawPipes();drawBird();drawScore();if(currentGameState===gameState.gameOver)drawGameOver();requestAnimationFrame(gameLoop);}        
        function handleInput(){if(currentGameState===gameState.playing){bird.velocity=JUMP;jumpSound.currentTime=0;jumpSound.play();}else if(currentGameState===gameState.gameOver){setTimeout(resetGame,300);}}
        startButton.addEventListener('click',e=>{e.preventDefault();startScreen.style.display='none';resetGame();});
        document.addEventListener('keydown',e=>{if(e.code==='Space'&&currentGameState!==gameState.start)handleInput();});
        canvas.addEventListener('mousedown', e => {if(currentGameState !== gameState.start) handleInput();});
        canvas.addEventListener('touchstart', e => {if(currentGameState !== gameState.start) {e.preventDefault(); // chỉ chặn trong canvas
        handleInput();}}, { passive: false });
        function initialize(){bestScore=localStorage.getItem('flappyBestScore')||0;currentGameState=gameState.start;bird={x:50,y:canvas.height/2,radius:15,velocity:0};pipes=[];score=0;}
        initialize();gameLoop();

        // ===== Nút =====
        document.getElementById("btn-sound")?.addEventListener("click",()=>{const btn=document.getElementById("btn-sound");if(jumpSound.muted){jumpSound.muted=false;gameoverSound.muted=false;btn.innerText="Âm thanh";}else{jumpSound.muted=true;gameoverSound.muted=true;btn.innerText="Tắt âm";}});
        document.getElementById("btn-exit")?.addEventListener("click",()=>window.history.back());
        document.getElementById("btn-exit-pc")?.addEventListener("click",()=>window.history.back());
    </script>
</body>
</html>
