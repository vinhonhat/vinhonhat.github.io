<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng c·ª• ki·ªÉm tra M√†n h√¨nh, Loa, Mic & Camera | Vinh ·ªü Nh·∫≠t</title>
 
<link rel="manifest" href="manifest.json"> 

<meta name="theme-color" content="#F6AD55"> 

<link rel="apple-touch-icon" href="/img/logo1.png"> 
    
<link rel="icon" href="/img/logoQV.png" type="image/x-icon"> 

<script src="https://cdn.tailwindcss.com"></script>
    
<link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<link rel="stylesheet" href="/css/style.css">

	<style>
        /* CSS cho c√¥ng c·ª• ki·ªÉm tra */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Inter', sans-serif;
        }

        /* 1. KHU V·ª∞C KI·ªÇM TRA M√ÄN H√åNH (M·∫∑c ƒë·ªãnh thu nh·ªè) */
        #screen-tester {
            width: 100%;
            height: 50vh; /* Thu nh·ªè ban ƒë·∫ßu */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer; 
            transition: background-color 0.3s ease; 
            background-color: #333; 
            position: relative;
            margin-top: 0; 
        }
        
        /* Ch·∫ø ƒë·ªô Full Screen s·∫Ω l√†m cho m√†n h√¨nh chi·∫øm to√†n b·ªô viewport */
        :fullscreen #screen-tester {
             height: 100vh !important;
             position: fixed !important;
             top: 0 !important;
             left: 0 !important;
             z-index: 9999 !important;
        }

        #color-name {
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
        }

        .hide-text #color-name {
            display: none;
        }
        
        /* CSS cho n√∫t chuy·ªÉn ch·∫ø ƒë·ªô (KH√îNG D√ôNG FIXED N·ªÆA) */
        #mode-switcher {
            /* Lo·∫°i b·ªè position: fixed; */
            margin: 20px auto; /* CƒÉn gi·ªØa v√† t·∫°o kho·∫£ng c√°ch */
            display: block; /* ƒê·∫£m b·∫£o n√≥ l√† block ƒë·ªÉ cƒÉn gi·ªØa */
            max-width: 300px;
            z-index: 1000;
            padding: 10px 15px;
            background: #F6AD55; /* M√†u theme c·ªßa b·∫°n */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #mode-switcher:hover {
            background: #d68e3e;
        }

        /* CSS c√≤n l·∫°i c·ªßa b·∫°n */
        .truncate-2-lines {
             display: -webkit-box;
             -webkit-box-orient: vertical;
             -webkit-line-clamp: 2; 
             overflow: hidden;
        }



        /* CSS M·ªöI T·ªëi ∆∞u cho b√†n ph√≠m */
        #keyboard-layout-container {
            /* Lo·∫°i b·ªè overflow-x-auto */
            overflow-x: hidden; 
        }

        .key-row {
            display: flex;
            margin-bottom: 5px; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c h√†ng */
            gap: 5px; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c ph√≠m */
        }

        .key {
            background-color: #333;
            color: white;
            border: 1px solid #555;
            padding: 2px 5px; /* Gi·∫£m padding */
            border-radius: 4px;
            text-align: center;
            font-size: 12px; /* Gi·∫£m k√≠ch th∆∞·ªõc ch·ªØ */
            min-width: 0; /* Cho ph√©p co l·∫°i */
            flex-grow: 1; /* R·∫•t quan tr·ªçng: cho ph√©p t·∫•t c·∫£ c√°c ph√≠m co gi√£n */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 35px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh */
            transition: background-color 0.1s, border-color 0.1s;
            cursor: default;
            /* D√πng Flexbox ƒë·ªÉ hi·ªÉn th·ªã nh√£n ph√≠m tr√™n 2 d√≤ng (v√≠ d·ª•: `~` v√† `1`) */
            flex-direction: column; 
            line-height: 1.1;
        }

        /* Hi·ªáu ·ª©ng khi ph√≠m ƒë∆∞·ª£c nh·∫•n */
        .key.active {
            background-color: #F6AD55 !important; 
            border-color: #FFD700 !important;
            color: #111 !important;
            box-shadow: 0 0 10px rgba(246, 173, 85, 0.8);
        }

        /* Hi·ªáu ·ª©ng sau khi ph√≠m ƒë√£ ƒë∆∞·ª£c nh·∫•n (m√†u x√°m) */
        .key.checked {
            background-color: #9b9a9a !important; 
            border-color: #cc4e4e !important;
            color: rgb(38, 0, 255) !important;
        }

        /* ƒêi·ªÅu ch·ªânh t·ªâ l·ªá cho c√°c ph√≠m d√†i (s·ª≠ d·ª•ng flex-grow) */
        .key.key-tab { flex-grow: 1.5; }
        .key.key-caps { flex-grow: 1.75; }
        .key.key-shift-l { flex-grow: 2.25; }
        .key.key-shift-r { flex-grow: 2.75; }
        .key.key-enter { flex-grow: 2.25; }
        .key.key-backslash { flex-grow: 1.5; }
        .key.key-space { flex-grow: 5; max-width: none; } /* Cho ph√©p space chi·∫øm nhi·ªÅu kh√¥ng gian h∆°n */


        /* CSS ƒë·∫∑c bi·ªát cho ph√≠m Ctrl/Alt */
        .key.key-modifier {
            min-width: 50px;
        }
	</style>
</head>
<body 
    class="bg-[#FBF7F0]"
    
>
<div id="header-placeholder"></div>

<main>
        
        <div id="screen-tester">
            <h1 id="color-name">Nh·∫•n ph√≠m Space ƒë·ªÉ b·∫Øt ƒë·∫ßu ki·ªÉm tra (Full Screen)</h1>
            <p id="sub-text" class="text-white text-sm opacity-70">Nh·∫•n ESC ho·∫∑c Q ƒë·ªÉ tho√°t</p>
        </div>
        
        <button id="mode-switcher" style="display:none;">Ki·ªÉm tra Loa & Mic</button>
        
        <div id="peripheral-tester" style="display:none;" class="max-w-4xl mx-auto py-12 px-4">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-10">C√¥ng c·ª• Ki·ªÉm tra Loa, Mic & Camera</h2>

            <div id="speaker-tester" class="bg-white p-6 rounded-lg shadow-lg mb-8">
                <h3 class="text-2xl font-semibold mb-4 flex items-center"><i class="fas fa-volume-up mr-3 text-blue-500"></i>Ki·ªÉm Tra Loa (Stereo Check)</h3>
                <p class="text-center text-lg mb-4" id="speaker-status">ƒê·∫£m b·∫£o ƒë√£ c·∫Øm tai nghe ho·∫∑c b·∫≠t loa ngo√†i. Nh·∫•n START.</p>
                <div class="flex justify-center items-center space-x-6">
                    <button id="start-speaker-check" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded transition duration-300">
                        <i class="fas fa-play mr-2"></i>B·∫ÆT ƒê·∫¶U
                    </button>
                    <audio id="audio-player"></audio>
                </div>
            </div>
            
            <div id="camera-mic-tester" class="bg-white p-6 rounded-lg shadow-lg">
                <h3 class="text-2xl font-semibold mb-4 flex items-center"><i class="fas fa-video mr-3 text-red-500"></i>Ki·ªÉm Tra Mic & Camera</h3>
                <p class="text-center text-lg mb-4" id="camera-mic-status">Vui l√≤ng cho ph√©p d√πng camera v√† mic ƒë·ªÉ ki·ªÉm tra. Camera s·∫Ω hi·ªÉn th·ªã, Mic s·∫Ω hi·ªÉn th·ªã m·ª©c ƒë·ªô √¢m thanh.</p>
                <div class="flex justify-center mb-6">
                    <button id="start-camera-mic-check" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded transition duration-300">
                        <i class="fas fa-camera mr-2"></i>KI·ªÇM TRA
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <p class="font-medium text-center mb-2">Camera Preview</p>
                        <video id="video-preview" autoplay muted class="w-full bg-gray-200 rounded h-48"></video>
                    </div>
                    <div>
                        <p class="font-medium text-center mb-2">Microphone Level</p>
                        <canvas id="mic-level-canvas" class="w-full bg-gray-200 rounded h-48"></canvas>
                    </div>
                </div>
            </div>
            
            <div id="keyboard-tester" class="mt-12">
                <h3 class="text-2xl font-semibold mb-6 flex items-center"><i class="fas fa-keyboard mr-3 text-yellow-600"></i>Ki·ªÉm Tra B√†n Ph√≠m (Keyboard Test)</h3>
                <p class="text-center text-lg mb-4" id="keyboard-status">Nh·∫•n b·∫•t k·ª≥ ph√≠m n√†o tr√™n b√†n ph√≠m c·ªßa b·∫°n ƒë·ªÉ ki·ªÉm tra ph·∫£n h·ªìi.</p>

                <div id="keyboard-layout-container" class="bg-gray-900 p-6 rounded-lg shadow-xl overflow-x-auto">
                    </div>
                
                <div class="mt-4 text-center text-sm text-gray-500">
                    <i class="fas fa-desktop mr-1"></i> H·ªá ƒëi·ªÅu h√†nh: <span id="os-display" class="font-bold">ƒêang nh·∫≠n di·ªán...</span>
                </div>
            </div>

        </div>
    </main>
    
 <div id="footer-placeholder"></div>

    <script>
        // =========================================================================
        // 1. JAVASCRIPT ƒê∆Ø·ª¢C NH√öNG TR·ª∞C TI·∫æP
        // =========================================================================
        
        // ================== A. SCREEN CHECKER LOGIC ==================

        // --- KHAI B√ÅO BI·∫æN CHO M√ÄN H√åNH ---
        const colors = [
            { name: "ƒêEN", hex: "#000000" },
            { name: "TR·∫ÆNG", hex: "#FFFFFF" },
            { name: "ƒê·ªé", hex: "#FF0000" },
            { name: "XANH L√Å", hex: "#00FF00" },
            { name: "XANH D∆Ø∆†NG", hex: "#0000FF" },
            { name: "V√ÄNG", hex: "#FFFF00" },
            { name: "T√çM", hex: "#FF00FF" },
            { name: "X√ÅM", hex: "#808080" }
        ];

        let currentIndex = -1;
        const screenTester = document.getElementById('screen-tester');
        const colorNameDisplay = document.getElementById('color-name');
        const subText = document.getElementById('sub-text');
        let isFirstInteraction = true; 


        // 1. H√ÄM TH·ª∞C HI·ªÜN TO√ÄN M√ÄN H√åNH (toggleFullscreen)
        function toggleFullscreen() {
            const body = document.body;
            if (!document.fullscreenElement) {
                // Y√™u c·∫ßu ch·∫ø ƒë·ªô to√†n m√†n h√¨nh cho ph·∫ßn t·ª≠ body (bao tr√πm t·∫•t c·∫£)
                if (body.requestFullscreen) {
                    body.requestFullscreen();
                } else if (body.webkitRequestFullscreen) {
                    body.webkitRequestFullscreen();
                } else if (body.msRequestFullscreen) {
                    body.msRequestFullscreen();
                }
                subText.style.display = 'block';
                // ·∫®n n√∫t chuy·ªÉn ch·∫ø ƒë·ªô khi v√†o Fullscreen
                modeSwitcher.style.display = 'none'; 
            } else {
                // Tho√°t ch·∫ø ƒë·ªô to√†n m√†n h√¨nh 
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                subText.style.display = 'none'; 
                // Hi·ªÉn th·ªã l·∫°i n√∫t chuy·ªÉn ch·∫ø ƒë·ªô khi tho√°t Fullscreen
                modeSwitcher.style.display = 'block'; 
            }
        }

        // T·ª± ƒë·ªông ·∫©n subtext ban ƒë·∫ßu
        subText.style.display = 'none';

        // X·ª≠ l√Ω s·ª± ki·ªán khi Fullscreen thay ƒë·ªïi (d√πng ƒë·ªÉ ƒë·∫∑t l·∫°i tr·∫°ng th√°i)
        document.addEventListener('fullscreenchange', (event) => {
            if (!document.fullscreenElement) {
                // N·∫øu tho√°t Fullscreen (b·∫±ng ESC), ƒë∆∞a m√†n h√¨nh v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu
                screenTester.style.backgroundColor = '#333';
                colorNameDisplay.textContent = 'B·∫•m ho·∫∑c nh·∫•n Space ƒë·ªÉ b·∫Øt ƒë·∫ßu ki·ªÉm tra (Full Screen)';
                screenTester.classList.remove('hide-text');
                isFirstInteraction = true; // Cho ph√©p v√†o l·∫°i Fullscreen
                subText.style.display = 'none';
                // ƒê·∫£m b·∫£o n√∫t chuy·ªÉn ch·∫ø ƒë·ªô hi·ªán ra sau khi ESC
                modeSwitcher.style.display = 'block'; 
            }
        });


        // 2. H√ÄM CHUY·ªÇN M√ÄU (changeColor)
        function changeColor() {
            // K√çCH HO·∫†T TO√ÄN M√ÄN H√åNH T·∫†I ƒê√ÇY (Trong t∆∞∆°ng t√°c ƒë·∫ßu ti√™n)
            if (isFirstInteraction) {
                toggleFullscreen();
                isFirstInteraction = false;
            }

            // ƒê·∫£m b·∫£o ch·ªâ thay ƒë·ªïi m√†u khi ƒëang ·ªü ch·∫ø ƒë·ªô ki·ªÉm tra m√†n h√¨nh
            if (screenTester.style.display === 'none' && !document.fullscreenElement) return;

            currentIndex = (currentIndex + 1) % colors.length; 
            const currentColor = colors[currentIndex];

            // C·∫≠p nh·∫≠t giao di·ªán
            screenTester.style.backgroundColor = currentColor.hex;
            colorNameDisplay.textContent = currentColor.name;

            // ƒêi·ªÅu ch·ªânh m√†u ch·ªØ
            if (currentColor.hex === "#FFFFFF") {
                colorNameDisplay.style.color = "black";
            } else {
                colorNameDisplay.style.color = "white";
            }

            // ·∫®n ch·ªØ khi ·ªü ch·∫ø ƒë·ªô ƒêen, Tr·∫Øng, X√°m
            if (currentColor.hex === "#000000" || currentColor.hex === "#FFFFFF" || currentColor.hex === "#808080") {
                screenTester.classList.add('hide-text');
                subText.style.display = 'none';
            } else {
                screenTester.classList.remove('hide-text');
                subText.style.display = 'block';
            }
        }


        // 3. S·ª∞ KI·ªÜN L·∫ÆNG NGHE (M√ÄN H√åNH)
        screenTester.addEventListener('click', changeColor);

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                // Ch·ªâ chuy·ªÉn m√†u n·∫øu ƒëang ·ªü ch·∫ø ƒë·ªô ki·ªÉm tra m√†n h√¨nh
                if (screenTester.style.display !== 'none') {
                    changeColor();
                }
            }
            // D√πng ph√≠m 'Q' ƒë·ªÉ tho√°t Fullscreen th·ªß c√¥ng (ho·∫∑c ESC t·ª± ƒë·ªông)
            if (e.code === 'KeyQ' && document.fullscreenElement) {
                toggleFullscreen();
            }
        });

        // ================== B. SPEAKER CHECKER LOGIC ==================

        // --- KHAI B√ÅO BI·∫æN CHO LOA ---
        const peripheralTester = document.getElementById('peripheral-tester');
        const audioPlayer = document.getElementById('audio-player');
        const speakerStatus = document.getElementById('speaker-status');
        const startSpeakerButton = document.getElementById('start-speaker-check');
        const modeSwitcher = document.getElementById('mode-switcher');

        // Danh s√°ch c√°c t·ªáp √¢m thanh c·∫ßn ph√°t theo th·ª© t·ª±
        const audioSources = [
            { src: '/file/mp3/left_speaker.mp3', status: 'ƒêang ph√°t: LOA TR√ÅI (LEFT) - Nghe k·ªπ.' },
            { src: '/file/mp3/right_speakermp3', status: 'ƒêang ph√°t: LOA PH·∫¢I (RIGHT) - Nghe k·ªπ.' }
        ];

        let audioIndex = 0;

        // H√ÄM CHUY·ªÇN CH·∫æ ƒê·ªò (M√†u <-> Thi·∫øt b·ªã ngo·∫°i vi)
        modeSwitcher.addEventListener('click', () => {
            if (screenTester.style.display !== 'none') {
                // Chuy·ªÉn sang ch·∫ø ƒë·ªô Thi·∫øt b·ªã ngo·∫°i vi
                screenTester.style.display = 'none';
                peripheralTester.style.display = 'block';
                modeSwitcher.textContent = 'Chuy·ªÉn sang Ki·ªÉm tra M√†n h√¨nh';
            } else {
                // Chuy·ªÉn sang ch·∫ø ƒë·ªô M√†n h√¨nh
                peripheralTester.style.display = 'none';
                screenTester.style.display = 'flex';
                modeSwitcher.textContent = 'Chuy·ªÉn sang Ki·ªÉm tra Loa & Mic';
            }
            
            // T·∫Øt fullscreen n·∫øu ƒëang m·ªü
            if (document.fullscreenElement) {
                toggleFullscreen();
            }
        });

        // Hi·ªán n√∫t chuy·ªÉn ch·∫ø ƒë·ªô sau khi trang t·∫£i xong
        document.addEventListener('DOMContentLoaded', () => {
             // Ch·ªâ hi·ªÉn th·ªã n√∫t chuy·ªÉn ch·∫ø ƒë·ªô n·∫øu ƒëang ·ªü ch·∫ø ƒë·ªô ki·ªÉm tra m√†n h√¨nh ban ƒë·∫ßu
            if (screenTester.style.display !== 'none') {
                 modeSwitcher.style.display = 'block';
            }
        });

        // H√ÄM PH√ÅT √ÇM THANH THEO TH·ª® T·ª∞
        function playNextAudio() {
            if (audioIndex < audioSources.length) {
                const currentAudio = audioSources[audioIndex];
                
                speakerStatus.textContent = currentAudio.status;
                
                audioPlayer.src = currentAudio.src;
                audioPlayer.play().catch(error => {
                    speakerStatus.textContent = 'B·ªä CH·∫∂N: Vui l√≤ng click l·∫°i n√∫t START (Tr√¨nh duy·ªát ch·∫∑n Auto-Play)';
                    console.error("L·ªói ph√°t √¢m thanh:", error);
                });

                audioIndex++;
            } else {
                speakerStatus.textContent = 'ƒê√£ ho√†n th√†nh ki·ªÉm tra loa. Vui l√≤ng nh·∫•n START ƒë·ªÉ ki·ªÉm tra l·∫°i.';
                startSpeakerButton.disabled = false; 
                audioIndex = 0; 
            }
        }

        // S·ª∞ KI·ªÜN KHI √ÇM THANH K·∫æT TH√öC
        audioPlayer.addEventListener('ended', playNextAudio);

        // S·ª∞ KI·ªÜN CLICK N√öT START
        startSpeakerButton.addEventListener('click', () => {
            startSpeakerButton.disabled = true; 
            audioIndex = 0; 
            playNextAudio();
        });


        // ================== C. CAMERA/MIC CHECKER LOGIC ==================

        const startCameraMicButton = document.getElementById('start-camera-mic-check');
        const videoPreview = document.getElementById('video-preview');
        const micLevelCanvas = document.getElementById('mic-level-canvas');
        const canvasCtx = micLevelCanvas.getContext('2d');
        const cameraMicStatus = document.getElementById('camera-mic-status');
        let animationFrame;

        startCameraMicButton.addEventListener('click', () => {
            startCameraMicButton.disabled = true;
            cameraMicStatus.textContent = 'ƒêang y√™u c·∫ßu c·∫•p quy·ªÅn...';
            
            // Y√™u c·∫ßu truy c·∫≠p Mic v√† Camera
            navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                .then(stream => {
                    cameraMicStatus.textContent = 'ƒê√£ c·∫•p quy·ªÅn. Camera v√† Mic ƒëang ho·∫°t ƒë·ªông.';

                    // 1. Camera
                    videoPreview.srcObject = stream;
                    
                    // 2. Microphone (Hi·ªÉn th·ªã m·ª©c ƒë·ªô √¢m thanh)
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const analyser = audioContext.createAnalyser();
                    const microphone = audioContext.createMediaStreamSource(stream);
                    
                    microphone.connect(analyser);
                    analyser.fftSize = 256;
                    const bufferLength = analyser.frequencyBinCount;
                    const dataArray = new Uint8Array(bufferLength);
                    
                    function draw() {
                        canvasCtx.clearRect(0, 0, micLevelCanvas.width, micLevelCanvas.height);
                        
                        analyser.getByteFrequencyData(dataArray);

                        let sum = 0;
                        for (let i = 0; i < bufferLength; i++) {
                            sum += dataArray[i];
                        }
                        const average = sum / bufferLength;
                        
                        const barHeight = average * 1.5; 
                        const finalHeight = Math.min(barHeight, micLevelCanvas.height);

                        canvasCtx.fillStyle = '#C0392B'; 
                        canvasCtx.fillRect(0, micLevelCanvas.height - finalHeight, micLevelCanvas.width, finalHeight);
                        
                        animationFrame = requestAnimationFrame(draw);
                    }
                    draw();
                })
                .catch(err => {
                    cameraMicStatus.textContent = `L·ªñI TRUY C·∫¨P: ${err.name}. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p Camera/Mic.`;
                    startCameraMicButton.disabled = false;
                });
        });
        // ================== D. KEYBOARD CHECKER LOGIC ==================

        const keyboardLayoutContainer = document.getElementById('keyboard-layout-container');
        const osDisplay = document.getElementById('os-display');

        
        // ƒê·ªãnh nghƒ©a m√£ ph√≠m (key codes) v√† nh√£n hi·ªÉn th·ªã cho 2 HƒêH
        // S·ª¨ D·ª§NG M√É `e.code` (Code) v√¨ n√≥ ƒë·ªôc l·∫≠p v·ªõi layout ng√¥n ng·ªØ
        const KEY_LAYOUTS = {
            // Layout cho Windows
            windows: [
                ['Escape', 'F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11', 'F12', 'PrintScreen', 'ScrollLock', 'Pause', 'Home', 'End'],
                ['Backquote', 'Digit1', 'Digit2', 'Digit3', 'Digit4', 'Digit5', 'Digit6', 'Digit7', 'Digit8', 'Digit9', 'Digit0', 'Minus', 'Equal', 'Backspace', 'NumLock', 'NumpadDivide', 'NumpadMultiply', 'NumpadSubtract', 'NumpadAdd'],
                ['Tab', 'KeyQ', 'KeyW', 'KeyE', 'KeyR', 'KeyT', 'KeyY', 'KeyU', 'KeyI', 'KeyO', 'KeyP', 'BracketLeft', 'BracketRight', 'Backslash', '','Numpad7', 'Numpad8', 'Numpad9'],
                ['CapsLock', 'KeyA', 'KeyS', 'KeyD', 'KeyF', 'KeyG', 'KeyH', 'KeyJ', 'KeyK', 'KeyL', 'Semicolon', 'Quote', 'Enter', '','Numpad4', 'Numpad5', 'Numpad6'],
                ['ShiftLeft', 'KeyZ', 'KeyX', 'KeyC', 'KeyV', 'KeyB', 'KeyN', 'KeyM', 'Comma', 'Period', 'Slash', 'ShiftRight', '','Numpad1', 'Numpad2', 'Numpad3'],
                ['ControlLeft', 'MetaLeft', 'AltLeft', 'Space', 'AltRight', 'ContextMenu', 'ControlRight', 'ArrowUp', '','Numpad0', 'NumpadDecimal', 'NumpadEnter'],
                ['', '', '', '', '', '', '','', '','', '','', '', '', 'ArrowLeft', 'ArrowDown', 'ArrowRight','','', '','',''] // H√†ng cu·ªëi cho c√°c ph√≠m m≈©i t√™n
            ],
            // Layout cho macOS
            macos: [
                ['Escape', 'F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11', 'F12', 'VolumeUp', 'VolumeDown', 'Mute', 'PlayPause', 'Eject'], // Gi·∫£ ƒë·ªãnh m·ªôt s·ªë ph√≠m ch·ª©c nƒÉng Mac
                ['Backquote', 'Digit1', 'Digit2', 'Digit3', 'Digit4', 'Digit5', 'Digit6', 'Digit7', 'Digit8', 'Digit9', 'Digit0', 'Minus', 'Equal', 'Backspace'],
                ['Tab', 'KeyQ', 'KeyW', 'KeyE', 'KeyR', 'KeyT', 'KeyY', 'KeyU', 'KeyI', 'KeyO', 'KeyP', 'BracketLeft', 'BracketRight', 'Backslash'],
                ['CapsLock', 'KeyA', 'KeyS', 'KeyD', 'KeyF', 'KeyG', 'KeyH', 'KeyJ', 'KeyK', 'KeyL', 'Semicolon', 'Quote', 'Enter'],
                ['ShiftLeft', 'KeyZ', 'KeyX', 'KeyC', 'KeyV', 'KeyB', 'KeyN', 'KeyM', 'Comma', 'Period', 'Slash', 'ShiftRight', 'ArrowUp', ''],
                ['ControlLeft', 'AltLeft', 'MetaLeft', 'Space', 'MetaRight', 'AltRight', 'ControlRight', 'ArrowLeft', 'ArrowDown', 'ArrowRight'],
                ['', '', '', '']
            ]
        };

        // √Ånh x·∫° M√£ ph√≠m (e.code) sang Nh√£n hi·ªÉn th·ªã (Label)
        const KEY_LABELS = {
            'Escape': 'Esc', 'Tab': 'Tab', 'CapsLock': 'Caps', 'ShiftLeft': 'Shift', 'ShiftRight': 'Shift',
            'ControlLeft': 'Ctrl', 'ControlRight': 'Ctrl', 'AltLeft': 'Alt', 'AltRight': 'Alt',
            'MetaLeft': '‚åò/Win', 'MetaRight': '‚åò/Win', 'Space': 'Space', 'Enter': 'Enter',
            'Backspace': 'Delete', 'Backquote': '` ~', 'Minus': '- _', 'Equal': '= +',
            'BracketLeft': '[ {', 'BracketRight': '] }', 'Backslash': '\\ |', 'Semicolon': '; :',
            'Quote': `' "`, 'Comma': ', <', 'Period': '. >', 'Slash': '/ ?',
            'Digit1': '1 !', 'Digit2': '2 @', /*... c·ª© th·∫ø cho c√°c ph√≠m s·ªë ...*/
            'PrintScreen': 'PrtSc', 'ScrollLock': 'ScrLk', 'Pause': 'Pause', 'Insert': 'Ins', 'Delete': 'Del',
            'ArrowUp': '‚Üë', 'ArrowDown': '‚Üì', 'ArrowLeft': '‚Üê', 'ArrowRight': '‚Üí',
            'ContextMenu': 'Menu', 'NumpadDivide': '/', 'NumpadMultiply': '*', 'NumpadSubtract': '-',
            'NumpadAdd': '+', 'NumpadDecimal': '.', 'NumpadEnter': 'Enter',
            // Nh√£n ƒë∆°n gi·∫£n cho c√°c ph√≠m ch·ªØ c√°i
            'KeyA': 'A', 'KeyB': 'B', 'KeyC': 'C', 'KeyD': 'D', 'KeyE': 'E', 'KeyF': 'F',
            // ... th√™m t·∫•t c·∫£ c√°c ph√≠m ch·ªØ c√°i kh√°c
        };
        // T·ª± ƒë·ªông th√™m nh√£n cho c√°c ph√≠m F v√† Digit c√≤n l·∫°i (v√≠ d·ª•)
        for (let i = 1; i <= 12; i++) { KEY_LABELS[`F${i}`] = `F${i}`; }
        for (let i = 0; i <= 9; i++) { KEY_LABELS[`Digit${i}`] = i; }
        for (let i = 0; i <= 9; i++) { KEY_LABELS[`Numpad${i}`] = i; }


        // 1. Nh·∫≠n di·ªán H·ªá ƒëi·ªÅu h√†nh
        function detectOS() {
            const userAgent = window.navigator.userAgent.toLowerCase();
            if (userAgent.indexOf('mac') > -1) {
                return 'macos';
            }
            if (userAgent.indexOf('win') > -1) {
                return 'windows';
            }
            return 'windows'; // M·∫∑c ƒë·ªãnh l√† windows n·∫øu kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c
        }
        const currentOS = detectOS();
        osDisplay.textContent = currentOS === 'macos' ? 'macOS (Apple)' : 'Windows';


        // 2. X√¢y d·ª±ng Layout b√†n ph√≠m d·ª±a tr√™n OS
        function buildKeyboardLayout(os) {
            const layout = KEY_LAYOUTS[os];
            keyboardLayoutContainer.innerHTML = ''; // X√≥a layout c≈©

            layout.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'key-row';
                
                row.forEach(keyCode => {
                    if (!keyCode) { // X·ª≠ l√Ω kho·∫£ng tr·ªëng (n·∫øu c√≥)
                        const spacer = document.createElement('div');
                        spacer.style.width = '30px'; 
                        rowDiv.appendChild(spacer);
                        return;
                    }

                    const keyDiv = document.createElement('div');
                    keyDiv.className = 'key';
                    keyDiv.id = `key-${keyCode}`; // ID quan tr·ªçng ƒë·ªÉ x·ª≠ l√Ω s·ª± ki·ªán
                    keyDiv.textContent = KEY_LABELS[keyCode] || keyCode.replace('Key', ''); // Hi·ªÉn th·ªã nh√£n

                    // Th√™m class ƒë·∫∑c bi·ªát cho c√°c ph√≠m d√†i/ƒë·∫∑c bi·ªát
                    if (keyCode === 'Tab') keyDiv.classList.add('key-tab');
                    if (keyCode === 'CapsLock') keyDiv.classList.add('key-caps');
                    if (keyCode === 'ShiftLeft') keyDiv.classList.add('key-shift-l');
                    if (keyCode === 'ShiftRight') keyDiv.classList.add('key-shift-r');
                    if (keyCode === 'Enter') keyDiv.classList.add('key-enter');
                    if (keyCode === 'Space') keyDiv.classList.add('key-space');
                    if (['ControlLeft', 'ControlRight', 'AltLeft', 'AltRight', 'MetaLeft', 'MetaRight'].includes(keyCode)) {
                        keyDiv.classList.add('key-modifier');
                    }
                    
                    rowDiv.appendChild(keyDiv);
                });
                
                keyboardLayoutContainer.appendChild(rowDiv);
            });
        }

        // G·ªçi h√†m x√¢y d·ª±ng layout khi t·∫£i trang
        buildKeyboardLayout(currentOS);

        // ... (Ti·∫øp t·ª•c trong th·∫ª <script> c·ªßa b·∫°n)

        // ================== E. KEYBOARD EVENT HANDLERS ==================

        // X·ª≠ l√Ω khi nh·∫•n ph√≠m (KeyDown)
    document.addEventListener('keydown', (e) => {
        // ... (Logic chuy·ªÉn m√†u gi·ªØ nguy√™n) ...

        // 2. Logic cho Key Test (N·∫øu ƒëang ·ªü ch·∫ø ƒë·ªô ki·ªÉm tra thi·∫øt b·ªã)
        if (peripheralTester.style.display !== 'none') {
            const targetKey = document.getElementById(`key-${e.code}`);
            if (targetKey) {
                e.preventDefault(); 
                // üí° 1. Khi nh·∫•n: B·∫¨T m√†u active (CAM)
                targetKey.classList.add('active');
                targetKey.classList.remove('checked'); // ƒê·∫£m b·∫£o l·ªõp checked b·ªã x√≥a
            }
        }
    });

    // X·ª≠ l√Ω khi nh·∫£ ph√≠m (KeyUp)
    document.addEventListener('keyup', (e) => {
        if (peripheralTester.style.display !== 'none') {
            const targetKey = document.getElementById(`key-${e.code}`);
            if (targetKey) {
                // üí° 2. Khi nh·∫£: T·∫ÆT active v√† B·∫¨T checked (X√ÅM)
                targetKey.classList.remove('active');
                targetKey.classList.add('checked');
            }
        }
    });


    // 3. H√†m Reset B√†n ph√≠m
    function resetKeyboard() {
        const checkedKeys = keyboardLayoutContainer.querySelectorAll('.key.checked, .key.active');
        checkedKeys.forEach(key => {
            key.classList.remove('checked');
            key.classList.remove('active');
        });
        document.getElementById('keyboard-status').textContent = 'Nh·∫•n b·∫•t k·ª≥ ph√≠m n√†o tr√™n b√†n ph√≠m c·ªßa b·∫°n ƒë·ªÉ ki·ªÉm tra ph·∫£n h·ªìi.';
    }

    // 4. S·ª± ki·ªán Reset
    resetKeyboardBtn.addEventListener('click', resetKeyboard);


        // =========================================================================
        // 2. CODE C·ª¶A B·∫†N (D√πng cho header/footer/logic ph√¢n trang)
        // (Gi·ªØ l·∫°i c√°c th·∫ª script src c≈© ƒë·ªÉ ƒë·∫£m b·∫£o logic header/footer ho·∫°t ƒë·ªông)
        // =========================================================================

    </script>
    <script src="/js/script.js"></script>
    <script src="/js/content.js"></script>
    <script src="/pages/page-logic.js"></script>
</body>
</html>